<ng-container *ngTemplateOutlet="itemTpl; context: { $implicit: isOpen$ | async}"></ng-container>

<ng-template #itemTpl let-isOpen>
  <article class="accord-item">
    <header class="accord-item__header" [class.opened]="isOpen">
      <ng-container *ngTemplateOutlet="headerDefaultTmpl; context: { $implicit: isOpen}"></ng-container>
    </header>

    <section class="accord-item__body" [ngClass]="{ 'opened': isOpen , 'closed': !isOpen }">
      <ng-container *ngTemplateOutlet="getItemBodyTemplate(item.body, bodyDefaultTmpl); context: { $implicit: getItemCtx(item.body) }"></ng-container>
    </section>
  </article>
</ng-template>

<ng-template #headerDefaultTmpl let-isOpen>
  <div class="header--control accord-item__logo">
    <span class="accord-item__header--start">
      <img class="accord-item__header-img accord-item__header--start-img" [src]="logo" alt="{{'&#x02261;'}}">
      <span *ngIf="item.itemNum">{{item.itemNum}}.</span>
    </span>
  </div>
  <div class=" header--control accord-item__title">
    {{item.title}}
  </div>
  <div class=" header--control accord-item__collapse">
    <span class="accord-item__header--end" [class.active]="isOpen">
      <ng-container *ngTemplateOutlet="isImgOpen ? twoImgOpen : defaultImgOpen; context: { $implicit: openSign, closer: closeSign, opened: isOpen }"></ng-container>
    </span>
  </div>
</ng-template>

<ng-template #bodyDefaultTmpl let-defctx>
  {{defctx}}
  <ng-content select=".accord-item__footer"></ng-content>
</ng-template>

<ng-template #twoImgOpen let-openImg let-closeImg="closer" let-opened="opened">
  <img class="accord-item__header-img accord-item__header--end-img" [src]="opened ? closeImg: openImg" [ngClass]="{ 'open': opened, 'close': !opened }" />
</ng-template>

<ng-template #defaultImgOpen let-openImg let-opened="opened">
  <img class="accord-item__header-img accord-item__header--end-img" [src]="openImg" [ngClass]="{ 'open': opened, 'close': !opened }">
</ng-template>